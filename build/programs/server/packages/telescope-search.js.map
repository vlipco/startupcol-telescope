{"version":3,"file":"/packages/telescope-search.js","sources":["telescope-search/lib/search.js","telescope-search/lib/server/log_search.js","telescope-search/lib/server/publications.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uC;AACA,0B;;AAEA,8C;AACA,4B;AACA,U;AACA,mB;AACA,oB;AACA,M;AACA,gB;AACA,gB;AACA,M;AACA,c;AACA,kB;AACA,K;AACA,I;AACA,G;;AAEA,gB;AACA,qB;AACA,qB;AACA,G;;AAEA,M;AACA,uF;AACA,6B;AACA,0C;AACA,mC;AACA,E;;;AAGA,8B;AACA,0D;AACA,sF;AACA,uD;AACA,0B;;AAEA,iC;AACA,qB;AACA,2B;;AAEA,qD;AACA,W;AACA,Y;AACA,sD;AACA,oD;AACA,oD;AACA,O;AACA,K;AACA,K;AACA,oB;AACA,C;;;;;;;;;;;;;;;;;;ACnDA,gC;AACA,mB;AACA,0B;AACA,oB;AACA,K;AACA,E;;;;;;;;;;;;;;;;;;ACLA,4C;AACA,uD;AACA,+B;AACA,mE;AACA,G;AACA,Y;AACA,G","sourcesContent":["// push \"search\" template to primaryNav\nprimaryNav.push('search');\n\nSearches = new Meteor.Collection(\"searches\", {\n  schema: new SimpleSchema({\n    _id: {\n      type: String,\n      optional: true\n    },\n    timestamp: {\n      type: Date\n    },\n    keyword: {\n      type: String\n    }\n  })\n});\n\nSearches.allow({\n  update: isAdminById\n, remove: isAdminById\n});\n\n// XXX\n// TODO: find a way to make the package use the same isAdminById as the rest of the app\nisAdminById=function(userId){\n  var user = Meteor.users.findOne(userId);\n  return !!(user && isAdmin(user));\n};\n\n\n// search post list parameters\nviewParameters.search = function (terms, baseParameters) {\n  // if query is empty, just return parameters that will result in an empty collection\n  if(typeof terms.query == 'undefined' || !terms.query)\n    return {find:{_id: 0}}\n\n  // log current search in the db\n  if(Meteor.isServer)\n    logSearch(terms.query);\n\n  var parameters = deepExtend(true, baseParameters, {\n    find: {\n      $or: [\n        {title: {$regex: terms.query, $options: 'i'}},\n        {url: {$regex: terms.query, $options: 'i'}},\n        {body: {$regex: terms.query, $options: 'i'}}\n      ]\n    }\n  });\n  return parameters;\n}","logSearch = function (keyword) {\n  Searches.insert({\n    timestamp: new Date(),\n    keyword: keyword\n  });\n};","Meteor.publish('searches', function(limit) {\n  var limit = typeof limit === undefined ? 20 : limit; \n  if(isAdminById(this.userId)){\n   return Searches.find({}, {limit: limit, sort: {timestamp: -1}});\n  }\n  return [];\n});"]}