{"version":3,"file":"/packages/telescope-module-embedly.js","sources":["telescope-module-embedly/lib/embedly.js","telescope-module-embedly/lib/server/get_embedly_data.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yB;AACA,+B;AACA,mB;AACA,iB;AACA,kB;AACA,G;AACA,C;AACA,wC;;AAEA,qB;AACA,wB;AACA,mB;AACA,iB;AACA,mB;AACA,kB;AACA,G;AACA,C;AACA,oC;;;AAGA,kB;AACA,6B;AACA,yB;AACA,G;;AAEA,0B;AACA,6B;AACA,mB;AACA,iB;AACA,kB;AACA,G;AACA,C;AACA,6C;;;;;;;;;;;;;;;;;;AChCA,iC;AACA,e;AACA,oD;AACA,4C;;AAEA,O;AACA,I;AACA,mB;AACA,oG;;AAEA,+C;AACA,e;AACA,wB;AACA,iB;AACA,yB;AACA,0B;AACA,4B;AACA,O;AACA,O;;AAEA,kC;AACA,iD;;AAEA,kD;;AAEA,gD;AACA,oC;;AAEA,gB;AACA,mB;AACA,sB;AACA,gB;AACA,G;AACA,C;;AAEA,gB;AACA,sC;AACA,oC;AACA,G;AACA,G;;AAEA,kC;AACA,e;AACA,wC;AACA,e;AACA,6B;AACA,8C;AACA,2B;AACA,+B;AACA,K;AACA,G;AACA,c;AACA,C;;AAEA,2C","sourcesContent":["var thumbnailProperty = {\n  propertyName: 'thumbnailUrl',\n  propertySchema: {\n    type: String,\n    optional: true\n  }\n}\naddToPostSchema.push(thumbnailProperty);\n\nvar mediaProperty = {\n  propertyName: 'media',\n  propertySchema: {\n    type: Object,\n    optional: true,\n    blackbox: true\n  }\n}\naddToPostSchema.push(mediaProperty);\n\n\npostModules.push({\n  template: 'postThumbnail', \n  position: 'center-left'\n});\n\nvar embedlyKeyProperty = {\n  propertyName: 'embedlyKey',\n  propertySchema: {\n    type: String,\n    optional: true\n  }\n}\naddToSettingsSchema.push(embedlyKeyProperty);","getEmbedlyData = function (url) {\n  var data = {}\n  var extractBase = 'http://api.embed.ly/1/extract';\n  var embedlyKey = getSetting('embedlyKey');\n\n  try {\n    \n    if(!embedlyKey)\n      throw new Error(\"Couldn't find an Embedly API key! Please add it to your Telescope settings.\")\n\n    var result = Meteor.http.get(extractBase, {\n      params: {\n        key: embedlyKey,\n        url: url,\n        image_width: 200,\n        image_height: 150,\n        image_method: 'crop'\n      }\n    });\n\n    if(!result.data.images.length)\n      throw new Error(\"Couldn't find an image!\");\n\n    data.thumbnailUrl = result.data.images[0].url;\n\n    if(typeof result.data.media !== 'undefined')\n      data.media = result.data.media\n\n    return data;\n  } catch (error) {\n    console.log(error)\n    return null;\n  }\n}\n\nMeteor.methods({\n  testGetEmbedlyData: function (url) {\n    console.log(getEmbedlyData(url))\n  }\n});\n\nvar extendPost = function (post) {\n  if(post.url){\n    var data = getEmbedlyData(post.url);\n    if(!!data){\n      if(!!data.thumbnailUrl)\n        post.thumbnailUrl = data.thumbnailUrl;\n      if(!!data.media.html)\n        post.media = data.media\n    }\n  }\n  return post;\n}\n\npostSubmitServerCallbacks.push(extendPost);"]}